# ๐ณ ุฏููู ูุธุงู ุชุฎุฒูู ุงูุจุทุงูุงุช ูู Firebase

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุงูู ูุชุฎุฒูู ูุฅุฏุงุฑุฉ ุงูุจุทุงูุงุช ุงูุจูููุฉ ูู Firebase Realtime Database ูุน ุงูุชุฑููุฒ ุนูู ุงูุฃูุงู ูุงูุฎุตูุตูุฉ.

---

## ๐๏ธ ูููู ุงูุจูุงูุงุช ูู Firebase

```
users/
  {uid}/
    cards/
      {cardId}/
        id: string                    // ูุนุฑู ุงูุจุทุงูุฉ
        cardNumber: string             // ุขุฎุฑ 4 ุฃุฑูุงู ููุท (ูุซู: "9012")
        bankName: string               // ุงุณู ุงูุจูู (ูุซู: "ูุตุฑู ุงูุฑุงุฌุญู")
        cardType: string               // ููุน ุงูุจุทุงูุฉ (mada, visa, mastercard)
        type: string                   // ุงูููุน ุจุงูุนุฑุจูุฉ (ูุฏู, ููุฒุง, ูุงุณุชุฑูุงุฑุฏ)
        holderName: string             // ุงุณู ุญุงูู ุงูุจุทุงูุฉ
        expiryDate: string             // ุชุงุฑูุฎ ุงูุงูุชูุงุก (MM/YY)
        isDefault: boolean             // ูู ูู ุงูุจุทุงูุฉ ุงูุงูุชุฑุงุถูุฉ
        createdAt: number              // timestamp
        updatedAt: number              // timestamp
```

### ูุซุงู:
```json
{
  "users": {
    "business_1234567890": {
      "cards": {
        "-NxAbCd123": {
          "id": "-NxAbCd123",
          "cardNumber": "9012",
          "bankName": "ูุตุฑู ุงูุฑุงุฌุญู",
          "cardType": "mada",
          "type": "ูุฏู",
          "holderName": "ูุญูุฏ ุฃุญูุฏ",
          "expiryDate": "12/25",
          "isDefault": true,
          "createdAt": 1701234567890,
          "updatedAt": 1701234567890
        }
      }
    }
  }
}
```

---

## ๐ ุงูุฃูุงู ูุงูุฎุตูุตูุฉ

### ูุง ูุชู ุญูุธู โ
- ุขุฎุฑ 4 ุฃุฑูุงู ูู ุงูุจุทุงูุฉ ููุท
- ุงุณู ุงูุจูู
- ููุน ุงูุจุทุงูุฉ (ูุฏูุ ููุฒุงุ ูุงุณุชุฑูุงุฑุฏ)
- ุงุณู ุญุงูู ุงูุจุทุงูุฉ
- ุชุงุฑูุฎ ุงูุงูุชูุงุก
- ุญุงูุฉ ุงูุจุทุงูุฉ ุงูุงูุชุฑุงุถูุฉ

### ูุง ูุง ูุชู ุญูุธู โ
- โ ุฑูู ุงูุจุทุงูุฉ ุงููุงูู (16 ุฑูู)
- โ CVV/CVC
- โ PIN

### ููุงุฐุง ูุฐุง ุขููุ
1. **ุขุฎุฑ 4 ุฃุฑูุงู ููุท**: ูุง ูููู ุงุณุชุฎุฏุงููุง ูุฅุฌุฑุงุก ูุนุงููุงุช
2. **ูุง CVV**: ุญุชู ูุน ุขุฎุฑ 4 ุฃุฑูุงูุ ูุง ูููู ุงุณุชุฎุฏุงู ุงูุจุทุงูุฉ
3. **Firebase Security Rules**: ูููู ุชุทุจูู ููุงุนุฏ ุฃูุงู ูููุตูู

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ/ุงููุนุฏูุฉ

### 1. CardService.js (ุฌุฏูุฏ)
**ุงููุณุงุฑ**: `src/common/services/cardService.js`

**ุงููุธููุฉ**: ุฎุฏูุฉ ุดุงููุฉ ูุฅุฏุงุฑุฉ ุงูุจุทุงูุงุช ูู Firebase

#### ุงูุฏูุงู ุงููุชุงุญุฉ:

```javascript
// 1. ุญูุธ ุจุทุงูุฉ ุฌุฏูุฏุฉ
await CardService.saveCard(uid, cardData);
// ุงูุฅุฑุฌุงุน: { success, message, cardId, card }

// 2. ุฌูุจ ุฌููุน ุจุทุงูุงุช ุงููุณุชุฎุฏู
await CardService.getUserCards(uid);
// ุงูุฅุฑุฌุงุน: { success, message, cards: [] }

// 3. ุญุฐู ุจุทุงูุฉ
await CardService.deleteCard(uid, cardId);
// ุงูุฅุฑุฌุงุน: { success, message }

// 4. ุชุญุฏูุซ ุจุทุงูุฉ
await CardService.updateCard(uid, cardId, updates);
// ุงูุฅุฑุฌุงุน: { success, message, card }

// 5. ุชุนููู ุจุทุงูุฉ ุงูุชุฑุงุถูุฉ
await CardService.setDefaultCard(uid, cardId);
// ุงูุฅุฑุฌุงุน: { success, message }

// 6. ุฌูุจ ุงูุจุทุงูุฉ ุงูุงูุชุฑุงุถูุฉ
await CardService.getDefaultCard(uid);
// ุงูุฅุฑุฌุงุน: { success, message, card }
```

---

### 2. CardSelectionScreen.js (ูุญุฏูุซ)
**ุงููุณุงุฑ**: `src/business/screens/wallet_topup/CardSelectionScreen.js`

#### ุงูุชุญุฏูุซุงุช:
- โ ุฌูุจ ุงูุจุทุงูุงุช ูู Firebase ุนูุฏ ุชุญููู ุงูุดุงุดุฉ
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุจุทุงูุงุช ุงููุญููุธุฉ
- โ ุญุฐู ุจุทุงูุฉ ูุน ุชุฃููุฏ
- โ ุชุญุฏูุซ ุงููุงุฆูุฉ ุชููุงุฆูุงู ุจุนุฏ ุฅุถุงูุฉ ุจุทุงูุฉ
- โ Pull-to-Refresh
- โ ุดุงุดุฉ ุชุญููู
- โ ุฑุณุงูุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ุจุทุงูุงุช
- โ ุนุฑุถ ุนุฏุฏ ุงูุจุทุงูุงุช
- โ ุนุฑุถ "ุงูุจุทุงูุฉ ุงูุงูุชุฑุงุถูุฉ"

#### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:

**ุฃ) ุฌูุจ ุงูุจุทุงูุงุช**:
```javascript
const loadCards = async () => {
  const result = await CardService.getUserCards(user.uid);
  if (result.success) {
    setCards(result.cards);
  }
};
```

**ุจ) ุญุฐู ุจุทุงูุฉ**:
```javascript
const handleDeleteCard = (cardId, cardNumber) => {
  Alert.alert(
    "ุญุฐู ุงูุจุทุงูุฉ",
    `ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุจุทุงูุฉ โขโขโขโข ${cardNumber}ุ`,
    [
      { text: "ุฅูุบุงุก", style: "cancel" },
      {
        text: "ุญุฐู",
        style: "destructive",
        onPress: async () => {
          await CardService.deleteCard(user.uid, cardId);
          loadCards(); // ุชุญุฏูุซ ุงููุงุฆูุฉ
        }
      }
    ]
  );
};
```

**ุฌ) Pull-to-Refresh**:
```javascript
<ScrollView
  refreshControl={
    <RefreshControl
      refreshing={refreshing}
      onRefresh={handleRefresh}
      tintColor={primaryColor}
    />
  }
>
```

---

### 3. AddCardScreen.js (ูุญุฏูุซ)
**ุงููุณุงุฑ**: `src/business/screens/wallet_topup/AddCardScreen.js`

#### ุงูุชุญุฏูุซุงุช:
- โ ุญูุธ ุงูุจุทุงูุฉ ูู Firebase
- โ ุชุดููุฑ ุงูุจูุงูุงุช (ุญูุธ ุขุฎุฑ 4 ุฃุฑูุงู ููุท)
- โ ุนุฏู ุญูุธ CVV
- โ ุดุงุดุฉ ุชุญููู ุฃุซูุงุก ุงูุญูุธ
- โ Callback ูุชุญุฏูุซ ุงููุงุฆูุฉ
- โ ุฎูุงุฑุงุช ุจุนุฏ ุงูุญูุธ (ูุชุงุจุนุฉ ููุฏูุน / ุงูุนูุฏุฉ)
- โ ูุนูููุงุช ุงูุฃูุงู

#### ุงูููุฏ ุงูุฑุฆูุณู:

```javascript
const handleSaveCard = async () => {
  // ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
  if (!validateForm()) return;

  const cleanCardNumber = cardNumber.replace(/\s/g, "");
  const lastFourDigits = cleanCardNumber.slice(-4); // ุขุฎุฑ 4 ุฃุฑูุงู ููุท
  const cardType = detectCardType(cleanCardNumber);

  const cardData = {
    cardNumber: lastFourDigits,  // โ ุขุฎุฑ 4 ุฃุฑูุงู ููุท
    bankName: getBankName(cleanCardNumber),
    cardType: cardType,
    type: arabicCardType,
    holderName: cardHolder,
    expiryDate: expiryDate,
    isDefault: false
    // โ ูุง ูุชู ุญูุธ CVV ุฃุจุฏุงู
  };

  // ุงูุญูุธ ูู Firebase
  const result = await CardService.saveCard(user.uid, cardData);

  if (result.success) {
    Alert.alert("ุชู ุจูุฌุงุญ", "ุชู ุญูุธ ุงูุจุทุงูุฉ ุจูุฌุงุญ", [
      {
        text: "ูุชุงุจุนุฉ ููุฏูุน",
        onPress: () => {
          // ุงุณุชุฏุนุงุก callback ูุชุญุฏูุซ ุงููุงุฆูุฉ
          if (onCardAdded) onCardAdded();

          // ุงูุงูุชูุงู ูุดุงุดุฉ ุงููุจูุบ
          navigation.navigate("TopupAmount", {
            cardData: {
              ...cardData,
              cvv: cvv, // CVV ููุงุณุชุฎุฏุงู ุงูููุฑู ููุท
              cardId: result.cardId
            }
          });
        }
      },
      {
        text: "ุงูุนูุฏุฉ ููุจุทุงูุงุช",
        onPress: () => {
          if (onCardAdded) onCardAdded();
          navigation.goBack();
        }
      }
    ]);
  }
};
```

---

### 4. index.js (ูุญุฏูุซ)
**ุงููุณุงุฑ**: `src/common/services/index.js`

#### ุงูุชุญุฏูุซ:
```javascript
export { default as CardService } from './cardService';
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### CardSelectionScreen

#### ุญุงูุฉ ุงูุชุญููู:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   โ ุงุฎุชุฑ ุงูุจุทุงูุฉ       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                         โ
โ      ๐ Loading...      โ
โ   ุฌุงุฑู ุชุญููู ุงูุจุทุงูุงุช  โ
โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### ุนุฑุถ ุงูุจุทุงูุงุช:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   โ ุงุฎุชุฑ ุงูุจุทุงูุฉ       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงูุจุทุงูุงุช ุงููุญููุธุฉ (2)  โ
โ                         โ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ณ  ูุตุฑู ุงูุฑุงุฌุญู  โ โ
โ โ     ูุฏู โขโขโขโข 9012  โ โ
โ โ  [ุงูุจุทุงูุฉ ุงูุงูุชุฑุงุถูุฉ] โ
โ โ              ๐๏ธ โ  โ โ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ                         โ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ณ  ุงูุจูู ุงูุฃููู   โ โ
โ โ     ููุฒุง โขโขโขโข 1234 โ โ
โ โ              ๐๏ธ    โ โ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ                         โ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ โ  + ุฅุถุงูุฉ ุจุทุงูุฉ ุฌุฏูุฏุฉโ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ                         โ
โ ๐ก๏ธ ุจูุงูุงุชู ูุญููุฉ ููุดูุฑุฉโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ     [ ูุชุงุจุนุฉ ]          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### ุนูุฏ ุนุฏู ูุฌูุฏ ุจุทุงูุงุช:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   โ ุงุฎุชุฑ ุงูุจุทุงูุฉ       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงูุจุทุงูุงุช ุงููุญููุธุฉ (0)  โ
โ                         โ
โ        โโโโโ            โ
โ        โ๐ณ โ            โ
โ        โโโโโ            โ
โ  ูุง ุชูุฌุฏ ุจุทุงูุงุช ูุญููุธุฉ  โ
โ  ูู ุจุฅุถุงูุฉ ุจุทุงูุฉ ุฌุฏูุฏุฉ  โ
โ                         โ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ โ  + ุฅุถุงูุฉ ุจุทุงูุฉ ุฌุฏูุฏุฉโ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ                         โ
โ ๐ก๏ธ ุจูุงูุงุชู ูุญููุฉ ููุดูุฑุฉโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### AddCardScreen

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ ุฅุถุงูุฉ ุจุทุงูุฉ ุฌุฏูุฏุฉ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ณ    VISA/MADA    โ โ
โ โ                    โ โ
โ โ 1234 5678 9012 3456โ โ
โ โ                    โ โ
โ โ ูุญูุฏ ุฃุญูุฏ    12/25 โ โ
โ โโโโโโโโโโโโโโโโโโโโโโ โ
โ                         โ
โ ุฑูู ุงูุจุทุงูุฉ:            โ
โ [1234 5678 9012 3456]  โ
โ                         โ
โ ุงุณู ุญุงูู ุงูุจุทุงูุฉ:       โ
โ [ูุญูุฏ ุฃุญูุฏ]            โ
โ                         โ
โ CVV:     ุชุงุฑูุฎ ุงูุงูุชูุงุก: โ
โ [โขโขโข]    [12/25]       โ
โ                         โ
โ ๐ ุฃูุงู ุงูุจูุงูุงุช       โ
โ โข ูุญูุธ ุขุฎุฑ 4 ุฃุฑูุงู ููุท โ
โ โข CVV ูุง ููุญูุธ ุฃุจุฏุงู    โ
โ โข ูุดูุฑุฉ ูู Firebase    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  [ ุญูุธ ุงูุจุทุงูุฉ ูุงููุชุงุจุนุฉ]โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

### 1๏ธโฃ ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ (ูุง ุชูุฌุฏ ุจุทุงูุงุช):

```
WalletCard
   โ [ุถุบุท "ุดุญู ุงููุญูุธุฉ"]
TopupMethodScreen
   โ [ุงุฎุชูุงุฑ "ุจุทุงูุฉ ุจูููุฉ"]
CardSelectionScreen
   โ [ูุง ุชูุฌุฏ ุจุทุงูุงุช - ุนุฑุถ ุฑุณุงูุฉ]
   โ [ุถุบุท "ุฅุถุงูุฉ ุจุทุงูุฉ ุฌุฏูุฏุฉ"]
AddCardScreen
   โ [ุฅุฏุฎุงู ุจูุงูุงุช ุงูุจุทุงูุฉ]
   โ [ุถุบุท "ุญูุธ ุงูุจุทุงูุฉ"]
   โ [ุญูุธ ูู Firebase: ุขุฎุฑ 4 ุฃุฑูุงู ููุท]
   โ [ูุงูุฐุฉ: "ุชู ุจูุฌุงุญ"]
   โ [ุฎูุงุฑ 1: "ูุชุงุจุนุฉ ููุฏูุน"]
TopupAmountScreen (ูุน ุจูุงูุงุช ุงูุจุทุงูุฉ + CVV)
   โ [ุฅุฏุฎุงู ุงููุจูุบ]
   โ [ุชุฃููุฏ ุงูุฏูุน]
PaymentProcessScreen
```

### 2๏ธโฃ ุงููุณุชุฎุฏู ุงูุญุงูู (ูุฏูู ุจุทุงูุงุช):

```
WalletCard
   โ [ุถุบุท "ุดุญู ุงููุญูุธุฉ"]
TopupMethodScreen
   โ [ุงุฎุชูุงุฑ "ุจุทุงูุฉ ุจูููุฉ"]
CardSelectionScreen
   โ [๐ฅ ุฌูุจ ุงูุจุทุงูุงุช ูู Firebase]
   โ [ุนุฑุถ ุงููุงุฆูุฉ]
   โ [ุงุฎุชูุงุฑ ุจุทุงูุฉ ููุฌูุฏุฉ]
   โ [ุถุบุท "ูุชุงุจุนุฉ"]
TopupAmountScreen
   โ [ุฅุฏุฎุงู ุงููุจูุบ]
   โ [ุทูุจ CVV ููุจุทุงูุฉ ุงููุฎุชุงุฑุฉ]
   โ [ุชุฃููุฏ ุงูุฏูุน]
PaymentProcessScreen
```

### 3๏ธโฃ ุญุฐู ุจุทุงูุฉ:

```
CardSelectionScreen
   โ [ุถุบุท ุฃููููุฉ ุงูุญุฐู ๐๏ธ]
   โ [ูุงูุฐุฉ ุชุฃููุฏ: "ูู ุฃูุช ูุชุฃูุฏุ"]
   โ [ุถุบุท "ุญุฐู"]
Firebase: ุญุฐู ูู users/{uid}/cards/{cardId}
   โ [ุชุญุฏูุซ ุงููุงุฆูุฉ]
   โ [ุนุฑุถ ุงููุงุฆูุฉ ุงููุญุฏุซุฉ]
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### Test Case 1: ุฅุถุงูุฉ ุจุทุงูุฉ ุฌุฏูุฏุฉ

**ุงูุฎุทูุงุช**:
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุฐูุจ ูู WalletCard โ ุดุญู ุงููุญูุธุฉ
3. ุงุฎุชุฑ "ุจุทุงูุฉ ุจูููุฉ"
4. ุงุถุบุท "ุฅุถุงูุฉ ุจุทุงูุฉ ุฌุฏูุฏุฉ"
5. ุฃุฏุฎู:
   - ุฑูู ุงูุจุทุงูุฉ: 9876 5432 1098 7654
   - ุงูุงุณู: ุฃุญูุฏ ูุญูุฏ
   - CVV: 123
   - ุงูุงูุชูุงุก: 12/25
6. ุงุถุบุท "ุญูุธ ุงูุจุทุงูุฉ"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
- โ ูุงูุฐุฉ "ุชู ุจูุฌุงุญ"
- โ ุงูุจุทุงูุฉ ูุญููุธุฉ ูู Firebase
- โ ููุท "7654" ูุญููุธ (ุขุฎุฑ 4 ุฃุฑูุงู)
- โ CVV ุบูุฑ ูุญููุธ

**ุงูุชุญูู ูู Firebase Console**:
```json
{
  "users": {
    "business_xxx": {
      "cards": {
        "-NxYz123": {
          "cardNumber": "7654",  // โ ุขุฎุฑ 4 ุฃุฑูุงู ููุท
          "bankName": "ูุตุฑู ุงูุฑุงุฌุญู",
          "holderName": "ุฃุญูุฏ ูุญูุฏ",
          "expiryDate": "12/25",
          // โ ูุง ููุฌุฏ CVV
        }
      }
    }
  }
}
```

---

### Test Case 2: ุฌูุจ ุงูุจุทุงูุงุช

**ุงูุฎุทูุงุช**:
1. ุฃุถู 3 ุจุทุงูุงุช
2. ุฃุบูู ุงูุชุทุจูู
3. ุงูุชุญ ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู
4. ุงุฐูุจ ูู CardSelectionScreen

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
- โ ุดุงุดุฉ ุชุญููู ุชุธูุฑ
- โ ุงูุจุทุงูุงุช ุงูู3 ุชุธูุฑ ูู ุงููุงุฆูุฉ
- โ ุงูุนุฏุฏ ุตุญูุญ: "ุงูุจุทุงูุงุช ุงููุญููุธุฉ (3)"
- โ ุงูุจุทุงูุฉ ุงูุงูุชุฑุงุถูุฉ ุชุธูุฑ ุฃููุงู

---

### Test Case 3: ุญุฐู ุจุทุงูุฉ

**ุงูุฎุทูุงุช**:
1. ูู CardSelectionScreen
2. ุงุถุบุท ุฃููููุฉ ุงูุญุฐู ๐๏ธ ูุฃู ุจุทุงูุฉ
3. ูุงูุฐุฉ ุชุฃููุฏ ุชุธูุฑ
4. ุงุถุบุท "ุญุฐู"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
- โ ูุงูุฐุฉ "ุชู ุจูุฌุงุญ"
- โ ุงูุจุทุงูุฉ ูุญุฐููุฉ ูู ุงููุงุฆูุฉ
- โ ุงูุนุฏุฏ ูุญุฏุซ: ูุซูุงู ูู (3) ุฅูู (2)
- โ ุงูุจุทุงูุฉ ูุญุฐููุฉ ูู Firebase

---

### Test Case 4: Pull-to-Refresh

**ุงูุฎุทูุงุช**:
1. ูู CardSelectionScreen
2. ุงุณุญุจ ูุฃุณูู (Pull-to-Refresh)

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
- โ ูุคุดุฑ ุงูุชุญุฏูุซ ูุธูุฑ
- โ ุงููุงุฆูุฉ ุชูุญุฏูุซ ูู Firebase
- โ ุฃู ุชุบููุฑุงุช ูู ูุตุงุฏุฑ ุฃุฎุฑู ุชุธูุฑ

---

### Test Case 5: ุงูุฃูุงู - CVV ูุง ููุญูุธ

**ุงูุฎุทูุงุช**:
1. ุฃุถู ุจุทุงูุฉ ุฌุฏูุฏุฉ ูุน CVV: 999
2. ุงุญูุธ ุงูุจุทุงูุฉ
3. ุชุญูู ูู Firebase Console

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
```json
{
  "cardNumber": "1234",
  "bankName": "...",
  "holderName": "...",
  "expiryDate": "12/25"
  // โ ูุง ููุฌุฏ CVV ูู Firebase
}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุฃูุงู
- โ **ุขุฎุฑ 4 ุฃุฑูุงู ููุท**: ูุง ูููู ุงุณุชุฎุฏุงููุง ููุฏูุน
- โ **ูุง CVV**: ุญุชู ูุน ุขุฎุฑ 4 ุฃุฑูุงู ูุง ูููู ุงูุฏูุน
- โ๏ธ **Firebase Rules**: ูุฌุจ ุฅุถุงูุฉ ููุงุนุฏ ุฃูุงู:

```json
{
  "rules": {
    "users": {
      "$uid": {
        "cards": {
          ".read": "auth != null && auth.uid == $uid",
          ".write": "auth != null && auth.uid == $uid"
        }
      }
    }
  }
}
```

### 2. ุงูุฃุฏุงุก
- โ ุงูุจุทุงูุงุช ุชูุฌูุจ ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ูุชุญ ุงูุดุงุดุฉ
- โ Pull-to-Refresh ููุชุญุฏูุซ ุงููุฏูู
- โ Callback ูุชุญุฏูุซ ุงููุงุฆูุฉ ุจุนุฏ ุงูุฅุถุงูุฉ

### 3. ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุดุงุดุฉ ุชุญููู ุฃุซูุงุก ุงูุฌูุจ
- โ ุฑุณุงูุฉ ูุงุถุญุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ุจุทุงูุงุช
- โ ุชุฃููุฏ ูุจู ุงูุญุฐู
- โ ุฎูุงุฑุงุช ุจุนุฏ ุงูุญูุธ

### 4. ุงูุชุฑููุงุช ุงููุณุชูุจููุฉ

#### ุฃ) ุชุญุฏูุฏ ุงูุจูู ูู BIN
ุญุงููุงู ูุณุชุฎุฏู ููุทู ุจุณูุท:
```javascript
if (cleanNumber.startsWith("9")) return "ูุตุฑู ุงูุฑุงุฌุญู";
```

**ุงูุชุฑููุฉ**: ุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุจูุงูุงุช BIN:
```javascript
// ูููู ุงุณุชุฎุฏุงู API ูุซู:
// https://binlist.net/
// ุฃู ูุงุนุฏุฉ ุจูุงูุงุช ูุญููุฉ
const response = await fetch(`https://lookup.binlist.net/${first6Digits}`);
const data = await response.json();
return data.bank.name;
```

#### ุจ) ุจุทุงูุฉ ุงูุชุฑุงุถูุฉ ุชููุงุฆูุฉ
```javascript
// ูู CardService.saveCard()
// ุฅุฐุง ูุงูุช ูุฐู ุฃูู ุจุทุงูุฉุ ุงุฌุนููุง ุงูุชุฑุงุถูุฉ
const existingCards = await this.getUserCards(uid);
const isDefault = existingCards.cards.length === 0;

const card = {
  ...cardData,
  isDefault: isDefault
};
```

#### ุฌ) ุชุดููุฑ ุฅุถุงูู
```javascript
// ูููู ุชุดููุฑ ุงุณู ุญุงูู ุงูุจุทุงูุฉ
import CryptoJS from 'crypto-js';

const encrypted = CryptoJS.AES.encrypt(
  cardHolder,
  'secret-key'
).toString();

await CardService.saveCard(uid, {
  ...cardData,
  holderName: encrypted
});
```

---

## ๐ ุฅุญุตุงุฆูุงุช

### ุงููููุงุช:
- 1 ููู ุฎุฏูุฉ ุฌุฏูุฏ (cardService.js)
- 2 ููู ุดุงุดุฉ ูุญุฏุซ (CardSelectionScreen, AddCardScreen)
- 1 ููู index ูุญุฏุซ

### ุงูุฃุณุทุฑ:
- cardService.js: ~350 ุณุทุฑ
- CardSelectionScreen: ~340 ุณุทุฑ
- AddCardScreen: ~360 ุณุทุฑ
- **ุงููุฌููุน**: ~1050 ุณุทุฑ

### ุงูููุฒุงุช:
- โ 6 ุฏูุงู ูู CardService
- โ ุญูุธ ุขูู (ุขุฎุฑ 4 ุฃุฑูุงู ููุท)
- โ ุฌูุจ ูุนุฑุถ ุงูุจุทุงูุงุช
- โ ุญุฐู ุจุทุงูุฉ
- โ Pull-to-Refresh
- โ ุดุงุดุงุช ุชุญููู
- โ ูุนูููุงุช ุฃูุงู

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุงูู ูุขูู ูุชุฎุฒูู ุงูุจุทุงูุงุช ูู Firebase:

โ **ุงูุฃูุงู**: ุญูุธ ุขุฎุฑ 4 ุฃุฑูุงู ููุท - ูุง CVV
โ **ุงูุฎุตูุตูุฉ**: ุจูุงูุงุช ูุญููุฉ ููุดูุฑุฉ
โ **ุงูุณูููุฉ**: ูุงุฌูุฉ ุจุณูุทุฉ ูุณูุณุฉ
โ **ุงูุฃุฏุงุก**: ุฌูุจ ุณุฑูุน ูุน ุชุญุฏูุซ ุชููุงุฆู
โ **ุงููุฑููุฉ**: ุณูููุฉ ุงูุฅุถุงูุฉ ูุงูุญุฐู

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!** ๐

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุชู ุฃู ูุดููุฉ:

1. ุชุญูู ูู Console Logs
2. ุฑุงุฌุน ูููู Firebase ูู Console
3. ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู (`user.uid` ููุฌูุฏ)
4. ุชุญูู ูู Firebase Rules

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2024-12-06
**ุงูุฅุตุฏุงุฑ**: 1.0.0
**ุงูุญุงูุฉ**: โ ููุชูู ููุฎุชุจุฑ

**ุดูุฑุงู ูุงุณุชุฎุฏุงูู Absher Pay!** ๐
