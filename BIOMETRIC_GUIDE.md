# ุฏููู ูุธุงู ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุตูุฉ
## Absher Pay Biometric Authentication System

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูุชูุงูู ูุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุตูุฉ (Fingerprint/Face ID) ูุชุทุจูู Absher Pay ุจุงุณุชุฎุฏุงู:
- โ `expo-local-authentication` - ููุชุญูู ุงูุจูููุชุฑู
- โ `expo-secure-store` - ููุชุฎุฒูู ุงูุขูู
- โ Firebase Authentication - ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

---

## ๐ฏ ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

### ุงูููุชุจุงุช ุงููุซุจุชุฉ:
```bash
npx expo install expo-local-authentication expo-secure-store
```

### ุงูุตูุงุญูุงุช ูู app.json:
- **iOS**: `NSFaceIDUsageDescription` ูููุตูู ุฅูู Face ID/Touch ID
- **Android**: `USE_BIOMETRIC` ู `USE_FINGERPRINT`

---

## ๐ ุณูุฑ ุงูุนูู (User Flow)

### 1๏ธโฃ **ุงููุฑุฉ ุงูุฃููู - ุชุณุฌูู ุฏุฎูู ุนุงุฏู**

```
ุงููุณุชุฎุฏู ููุชุญ ุงูุชุทุจูู
    โ
ูุง ูุฑู ุฒุฑ "ุงูุฏุฎูู ุจุงูุจุตูุฉ" (ุงูุจุตูุฉ ุบูุฑ ููุนูุฉ)
    โ
ูุฏุฎู ุฑูู ุงููููุฉ ููููุฉ ุงููุฑูุฑ
    โ
ูุถุบุท "ุชุณุฌูู ุงูุฏุฎูู"
    โ
โ ุชุณุฌูู ุฏุฎูู ูุงุฌุญ
    โ
ูุธูุฑ ูู ุญูุงุฑ BiometricPromptDialog
"ูู ุชุฑูุฏ ุชูุนูู ุงูุจุตูุฉ ูุชุณุฌูู ุงูุฏุฎูู ุงูุณุฑูุนุ"
    โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
โ   ููุงูู    โ   ูุฑูุถ     โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโ
      โ              โ
  ูุชู ุญูุธ        ููุชูู
  ุงูุจูุงูุงุช      ูุจุงุดุฑุฉ
  ุจุฃูุงู         ููุชุทุจูู
  ูู SecureStore
      โ
  ููุชูู ููุชุทุจูู
```

### 2๏ธโฃ **ุชุณุฌูู ุงูุฏุฎูู ุงููุชูุฑุฑ - ุงูุจุตูุฉ ููุนูุฉ**

```
ุงููุณุชุฎุฏู ููุชุญ ุงูุชุทุจูู
    โ
ูุฑู ุฒุฑ "ุงูุฏุฎูู ุจุงูุจุตูุฉ" (โ ุงูุจุตูุฉ ููุนูุฉ)
    โ
ูุถุบุท ุนูู ุงูุฒุฑ
    โ
ุชุธูุฑ ูุงุฌูุฉ ุงูุจุตูุฉ ุงูุฎุงุตุฉ ุจุงููุธุงู
    โ
ุงูุชุญูู ูู ุงูุจุตูุฉ
    โ
โ ูุฌุญ โ ุฏุฎูู ูุจุงุดุฑ
โ ูุดู โ ุฑุณุงูุฉ ุฎุทุฃ
```

### 3๏ธโฃ **ูู ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช**

```
ุงููุณุชุฎุฏู ููุชุญ ุงูุฅุนุฏุงุฏุงุช
    โ
ูุฑู Toggle "ุงูุชุญูู ุงูุจูููุชุฑู"
    โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
โ  ุชูุนูู     โ   ุฅูุบุงุก     โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโ
      โ              โ
  ุทูุจ ุงูุชุญูู     ุชุฃููุฏ ุงูุฅูุบุงุก
  ูู ุงูุจุตูุฉ         โ
      โ         ุญุฐู ุงูุจูุงูุงุช
  ุญูุธ ุงูุจูุงูุงุช   ุงููุญููุธุฉ
```

---

## ๐ ุงููููุงุช ุงููููุฉ

### 1. **BiometricService.js**
ูููุน: `src/common/services/BiometricService.js`

ุงูุฎุฏูุฉ ุงูุฑุฆูุณูุฉ ูุฅุฏุงุฑุฉ ุงูุจุตูุฉ:

```javascript
// ุงูุฏูุงู ุงูุฑุฆูุณูุฉ:
checkBiometricSupport()       // ูุญุต ุฏุนู ุงูุฌูุงุฒ
authenticate()                // ุงูุชุญูู ูู ุงูุจุตูุฉ
saveBiometricCredentials()    // ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู
isBiometricEnabled()          // ุงูุชุญูู ูู ุงูุชูุนูู
loginWithBiometric()          // ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุตูุฉ
enableBiometric()             // ุชูุนูู ุงูุจุตูุฉ
disableBiometric()            // ุฅูุบุงุก ุงูุจุตูุฉ
```

### 2. **BiometricPromptDialog.js**
ูููุน: `src/common/components/BiometricPromptDialog.js`

ูููู ุงูุญูุงุฑ ุงูุฐู ูุธูุฑ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ุงููุงุฌุญ:
- ูุฏุนู variant: `'single'` ู `'business'`
- ูุนุฑุถ ูุฒุงูุง ุงุณุชุฎุฏุงู ุงูุจุตูุฉ
- ุฃุฒุฑุงุฑ: "ุชูุนูู" ู "ุฑุจูุง ูุงุญูุงู"

### 3. **BusinessLoginScreen.js**
ูููุน: `src/auth/screens/BusinessLoginScreen.js`

ุดุงุดุฉ ุชุณุฌูู ุฏุฎูู ุงูุฃุนูุงู ูุน ุฏุนู ุงูุจุตูุฉ:
- ุนุฑุถ ุฒุฑ ุงูุจุตูุฉ ุนูุฏ ุงูุชูุนูู
- ุทูุจ ุชูุนูู ุงูุจุตูุฉ ุจุนุฏ ุชุณุฌูู ุฏุฎูู ูุงุฌุญ
- ุชุณุฌูู ุฏุฎูู ุณุฑูุน ุจุงูุจุตูุฉ

### 4. **SingleLoginScreen.js**
ูููุน: `src/auth/screens/SingleLoginScreen.js`

ุดุงุดุฉ ุชุณุฌูู ุฏุฎูู ุงูุฃูุฑุงุฏ ูุน ููุณ ุงูููุฒุงุช

### 5. **SettingsScreen.js**
ูููุน: `src/business/screens/Settings/SettingsScreen.js`

ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ูุน Toggle ููุจุตูุฉ:
- ุชูุนูู/ุฅูุบุงุก ุงูุจุตูุฉ
- ุนุฑุถ ููุน ุงูุจุตูุฉ (ุจุตูุฉ ุงูุฅุตุจุน/Face ID)
- ุญุฐู ุงูุจูุงูุงุช ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ

---

## ๐ ุงูุฃูุงู ูุงูุชุฎุฒูู

### ุงูุจูุงูุงุช ุงููุญููุธุฉ:
```javascript
// ูู SecureStore (ุชุฎุฒูู ุขูู ููุดูุฑ)
{
  biometric_enabled: "true",           // ุญุงูุฉ ุงูุชูุนูู
  user_uid: "firebase_uid_here",       // ูุนุฑู ุงููุณุชุฎุฏู
  user_type: "single" | "business"     // ููุน ุงูุญุณุงุจ
}
```

### โ๏ธ ููุงุญุธุงุช ุฃูููุฉ:
- โ **ูุง ูุชู ุญูุธ ูููุฉ ุงููุฑูุฑ ุฃุจุฏุงู**
- โ ูุชู ุญูุธ UID ููุท ููุชุญูู ูู Firebase
- โ ุงูุจูุงูุงุช ูุฎุฒูุฉ ูู SecureStore ุงููุดูุฑ
- โ ุญุฐู ุชููุงุฆู ููุจูุงูุงุช ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุงูุฃููุงู ุญุณุจ ุงูููุน:
```javascript
// Business (ุฃุนูุงู)
primary: #0055aa (ุฃุฒุฑู)

// Single (ุฃูุฑุงุฏ)
primary: #028550 (ุฃุฎุถุฑ)
```

### ุงูุญุงูุงุช ุงููุฑุฆูุฉ:
```javascript
// ุนูุฏ ุชูุนูู ุงูุจุตูุฉ
{biometricEnabled && biometricSupported && (
  <BiometricLoginBox>
    ุชุณุฌูู ุงูุฏุฎูู ุจ{biometricType}
  </BiometricLoginBox>
)}

// ุนูุฏ ุนุฏู ุงูุชูุนูู
{!biometricEnabled && (
  <DigitalIDLoginBox>
    ุชุณุฌูู ุงูุฏุฎูู ุจุงููููุฉ ุงูุฑูููุฉ
  </DigitalIDLoginBox>
)}
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ููุชุทููุฑ ุนูู Expo Go:
```bash
# ุชุดุบูู ุนูู iOS (ูุฏุนู Face ID/Touch ID)
npx expo start --ios

# ุชุดุบูู ุนูู Android (ูุฏุนู Fingerprint)
npx expo start --android
```

### ููุงุฎุชุจุงุฑ ุนูู ุงููุญุงูู:
- **iOS Simulator**: Features > Face ID > Enrolled
- **Android Emulator**: Settings > Security > Fingerprint

---

## ๐ฑ ุฃููุงุน ุงูุจุตูุฉ ุงููุฏุนููุฉ

```javascript
AuthenticationType.FINGERPRINT        // ุจุตูุฉ ุงูุฅุตุจุน
AuthenticationType.FACIAL_RECOGNITION // Face ID
AuthenticationType.IRIS              // ุจุตูุฉ ุงูุนูู
```

ุงููุธุงู ููุชุดู ุชููุงุฆูุงู ุงูููุน ุงููุชุงุญ ููุนุฑุถู ุจุงูุนุฑุจู.

---

## โ๏ธ ููููุฉ ุงูุงุณุชุฎุฏุงู ูู ููุฏ ุฌุฏูุฏ

### ูุซุงู 1: ูุญุต ุฏุนู ุงูุจุตูุฉ
```javascript
import BiometricService from '../services/BiometricService';

const checkSupport = async () => {
  const result = await BiometricService.checkBiometricSupport();

  if (result.isSupported) {
    console.log('ููุน ุงูุจุตูุฉ:', result.biometricType);
  } else {
    console.log('ุณุจุจ ุนุฏู ุงูุฏุนู:', result.message);
  }
};
```

### ูุซุงู 2: ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุตูุฉ
```javascript
const loginWithBio = async () => {
  const result = await BiometricService.loginWithBiometric(
    'ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุงูุชุทุจูู'
  );

  if (result.success) {
    const { uid, userType } = result.credentials;
    // ุงููุชุงุจุนุฉ ููุชุทุจูู
  }
};
```

### ูุซุงู 3: ุชูุนูู ุงูุจุตูุฉ
```javascript
const enable = async (uid, userType) => {
  const result = await BiometricService.enableBiometric(uid, userType);

  if (result.success) {
    Alert.alert('ูุฌุญ', 'ุชู ุชูุนูู ุงูุจุตูุฉ');
  }
};
```

---

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ:
```javascript
// ุงูุฌูุงุฒ ูุง ูุฏุนู ุงูุจุตูุฉ
{
  isSupported: false,
  message: 'ุงูุฌูุงุฒ ูุง ูุฏุนู ุงูุจุตูุฉ ุฃู Face ID'
}

// ูุง ุชูุฌุฏ ุจุตูุงุช ูุณุฌูุฉ
{
  isSupported: false,
  message: 'ูุง ุชูุฌุฏ ุจุตูุงุช ูุณุฌูุฉ ุนูู ุงูุฌูุงุฒ'
}

// ุงููุณุชุฎุฏู ุฃูุบู ุงูุนูููุฉ
{
  success: false,
  error: 'user_cancel'
}

// ูุดู ุงูุชุญูู
{
  success: false,
  message: 'ูุดู ุงูุชุญูู ูู ุงูุจุตูุฉ'
}
```

---

## ๐ TODO ุงููุณุชูุจูู

- [ ] ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ุงุณุชุฎุฏุงู ุงูุจุตูุฉ
- [ ] ุชูุจูู ุงููุณุชุฎุฏู ุจุนุฏ ุนุฏุฉ ูุญุงููุงุช ูุงุดูุฉ
- [ ] ุฏุนู ุฃูุซุฑ ูู ุฌูุงุฒ (Multi-device)
- [ ] ุฅุถุงูุฉ ุฎูุงุฑ ุฅุนุงุฏุฉ ุชุนููู ุงูุจุตูุฉ
- [ ] ุชุณุฌูู ุณุฌู ุงูุฏุฎูู ุจุงูุจุตูุฉ

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุจุตูุฉ ูุง ุชุนูู ุนูู iOS
**ุงูุญู:**
```json
// ุชุฃูุฏ ูู ูุฌูุฏ ุงูุตูุงุญูุฉ ูู app.json
"ios": {
  "infoPlist": {
    "NSFaceIDUsageDescription": "..."
  }
}
```

### ุงููุดููุฉ: ุงูุจุตูุฉ ูุง ุชุนูู ุนูู Android
**ุงูุญู:**
```json
// ุชุฃูุฏ ูู ุงูุตูุงุญูุงุช ูู app.json
"android": {
  "permissions": [
    "USE_BIOMETRIC",
    "USE_FINGERPRINT"
  ]
}
```

### ุงููุดููุฉ: ุงูุจูุงูุงุช ูุง ุชูุญูุธ
**ุงูุญู:**
- ุชุญูู ูู ุชุซุจูุช `expo-secure-store`
- ุชุฃูุฏ ูู ูุฌูุฏ plugin ูู app.json

---

## ๐จโ๐ป ุงูุฏุนู ุงูููู

ุนูุฏ ููุงุฌูุฉ ูุดุงูู:
1. ุชุญูู ูู console logs
2. ุฑุงุฌุน ูุณู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
3. ุชุฃูุฏ ูู ุงูุตูุงุญูุงุช ูู app.json
4. ุฌุฑุจ ุนูู ุฌูุงุฒ ุญูููู ุจุฏูุงู ูู ุงููุญุงูู

---

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุธุงู ุฌุฒุก ูู ุชุทุจูู Absher Pay
ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ 2025

---

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ:** Claude Code
**ุงูุชุงุฑูุฎ:** ุฏูุณูุจุฑ 2025
**ุงูุฅุตุฏุงุฑ:** 1.0.0
